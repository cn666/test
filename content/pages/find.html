<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查询</title>
    <link rel="stylesheet" href="../../static/themes/vocsV2/main.css">
    <link rel="stylesheet" href="../../static/themes/vocsV2/find.css">
</head>
<style>
    body,html{
        display: flex;
        flex-flow: column;
        background: #EFEFEF;
    }
    .datagrid-header td, .datagrid-body td, .datagrid-footer td{
        border: none;
        border-bottom: 1px solid #D2D2D2;
        height: 50px;
    }
    .combo-arrow{
        height: 25px!important;
    }


</style>
<body>
<div class="rightTop">
    <p>查询</p>
</div>


<div class="finddown">
    <!--左侧-->
    <div class="tansfind">
        <!--查询条件-->
        <div class="tansfindTime">
            <div class="tansfindTimeT">
                <div class="blueline"></div>
                <p>查询条件</p>
            </div>
            <div class="tansfindTimeD">
                <div class="tanstimebox">
                    <p class="tansstartFont">企业名称：</p>
                    <input type="text" class="tansstartTime" id="qyname">
                    <p class="tansendFont">企业类型：</p>
                    <input type="text" class="tansendTime"  id="qytype">
                    <p class="tansendFont">行政区划：</p>
                    <input type="text" class="tansendTime"  id="area">
                    <button class="tancheck">查询</button>
                </div>
            </div>

        </div>


        <!--企业列表-->
        <div class="findqyname">
            <div class="findpsname">
                <div class="blueline"></div>
                <p>企业列表</p>
            </div>

            <div class="psnamebox">
                <!--<div class="psnamelist">-->
                <!--<div class="air"></div><span class="namefont">天津国电津能热电有限公司</span>-->
                <!--<div class="jiao "></div>-->
                <!--</div>-->
                <!--<div class="psnamelist">-->
                <!--<div class="air"></div><span class="namefont">天津国电津能热电有限公司</span>-->
                <!--<div class="jiao "></div>-->
                <!--</div>-->
                <!--<div class="psnamelist">-->
                <!--<div class="air"></div><span class="namefont">天津国电津能热电有限公司</span>-->
                <!--<div class="jiao "></div>-->
                <!--</div>-->
            </div>
        </div>

    </div>


    <!--右侧-->
    <div class="findDataR">
        <div class="findDataRbox">
            <!--右侧顶部-->
            <div class="findDataRtop">
                <span class="topqyname slh1">天津国电津能热电有限公司11111</span>
                <div class="tellbox">
                    <span class="iconTell phone"></span>
                    <div class="addguan">加关注</div>
                </div>
                <div class="tabbox">
                    <div class="tabitem tabactive">
                        <span class="icon-msg"></span>
                        <span class="tabfont">基本信息</span>
                    </div>
                    <div class="tabitem ">
                        <span class="icon-data"></span>
                        <span class="tabfont">历史数据</span>
                    </div>
                    <div class="tabitem">
                        <span class="icon-alarm"></span>
                        <span class="tabfont">报警信息</span>
                    </div>
                    <div class="tabitem">
                        <span class="icon-gis"></span>
                        <span class="tabfont">GIS定位</span>
                    </div>
                </div>
            </div>

            <!--右侧底部-->
            <!--基本信息-->
            <div class="findDataRdown">
                <form action="" id="basicform">
                    <div class="findDataRdownT">
                        <div class="findDataRdownTbox">
                            <div class="msgitem">
                                <label><span class="typename">企业编号</span><input type="text" value="" readonly class="readtext"  name="pscode"></label>
                                <label><span class="typename">中心经度</span><input type="text" value="117.21.12" readonly class="readtext" name="longitude"></label>
                                <label><span class="typename">中心纬度</span><input type="text" value="39.13.2" readonly class="readtext"  name="latitude"></label>
                                <label><span class="typename">关注程度</span><input type="text" value="国控" readonly class="readtext" name="guanzhu"></label>
                                <label><span class="typename">国控类型</span><input type="text" value="气国控" readonly class="readtext" name="guoType"></label>
                            </div>
                            <div class="msgitem">
                                <label><span class="typename">社会信用代码</span><input type="text" value="77731707-4" readonly class="readtext" name="shcode"></label>
                                <label><span class="typename">单位类别</span><input type="text" value="县以上工业企业" readonly class="readtext"  name="danType"></label>
                                <label><span class="typename">注册类型</span><input type="text" value="国有企业" readonly class="readtext" name="ceType"></label>
                                <label><span class="typename">监测类型</span><input type="text" value="气重点" readonly class="readtext" name="jianType"></label>
                                <label><span class="typename">污染源别名</span><input type="text" value="国电津能" readonly class="readtext" name="wry"></label>
                            </div>
                            <div class="msgitem">
                                <label><span class="typename">联系人</span><input type="text" value="77731707-4" readonly class="readtext" name="people"></label>
                                <label><span class="typename">单位地址</span><input type="text" value="天津市东丽区华明镇饭庄村北扬北公路" readonly class="readtext" style="width: 352px" name="address"></label>
                                <label><span class="typename">移动电话</span><input type="text" value="13875052369" readonly class="readtext" name="phone"></label>
                                <label><span class="typename">办公电话</span><input type="text" value="022-581265152" readonly class="readtext"  name="tell"></label>
                            </div>
                            <!--<div class="btnMore">更多...</div>-->
                        </div>
                    </div>
                </form>
                <!--表格-->
                <!--<div class="findDataRdownB">-->
                <!--<div class="findDataRdownBbox">-->
                <!--<div class="btnbox">-->
                <!--<span class="btnfont">单位：监控点流量（m3）、污染物浓度（mg/m3）</span>-->
                <!--<div class="radiobox">-->
                <!--<input type="radio" id="female1" name="wrwdata" checked />-->
                <!--<label for="female1" style="margin-right: 24px">折算数据</label>-->
                <!--<input type="radio" id="female2" name="wrwdata" />-->
                <!--<label for="female2">实测数据</label>-->
                <!--</div>-->
                <!--</div>-->

                <!--<div class="datatable">-->
                <!--<table id="tt" height="100%" width="100%" ></table>-->
                <!--</div>-->
                <!--</div>-->
                <!--</div>-->
            </div>


            <!--历史数据-->
            <div class="findDataRdownData">
                <!--历史数据查询条件-->
                <div class="historyTop">
                    <div class="hisitem">
                        <span>监控点:</span>
                        <input type="text"  class="jiankong"  id="jk">
                    </div>
                    <div class="hisitem">
                        <span>数据类型</span>
                        <input type="text"  class="datatype" id="datatype">
                    </div>
                    <div class="hisitem">
                        <span>污染物</span>
                        <input type="text"  class="wrw">

                    </div>
                    <div class="hisitem">
                        <span>监测时间</span>
                        <input type="text" class="jctime">
                    </div>
                    <div class="hisitem">
                        <div class="hisbtn">查询</div>
                    </div>
                </div>

                <!--历史数据图表-->
                <div class="historyMid" >
                    <div id="main"></div>
                </div>

                <div class="historyBom">
                    <table id="historyTable" height="98%" width="100%" ></table>
                </div>

            </div>


            <!--报警信息-->
            <div class="findDataRdownalarmData">
                <div class="alarmdataT">
                    <div class="btnalarm btnalarmAct">超标报警（<span>1</span>）</div>
                    <div class="btnalarm">超总量报警（<span>0</span>）</div>
                    <div class="btnalarm">故障报警（0）</div>
                </div>
                <div class="alarmdataD">
                    <div class="alarmdataDitem">
                        <div class="itemalarm mg20"><span>监控点：</span><input type="text" class="readtext" readonly  value="1号机级废气"></div>
                        <div class="itemalarm"><span>污染物：</span><input type="text" class="readtext" readonly value="烟尘"></div>
                        <div class="itemalarm"><span>报警时间：</span><input type="text" class="readtext" readonly value="2018-07-11 13:00"></div>
                        <div class="itemalarm mg20"><span>起报值：</span><input type="text" class="readtext w50" readonly value="38.9"><span>mg/m3</span>  </div>
                        <div class="itemalarm"><span>标准值：</span><input type="text" class="readtext w50" readonly value="20"><span>mg/m3</span></div>
                    </div>

                </div>
            </div>

            <!--gis定位-->
            <div class="findDataRdownGis">
                <div id="mapDiv" style="width:100%;height:100%"></div>
            </div>
        </div>
    </div>
</div>


<script type="text/html"   id="qylist">
    {{each result as li i}}
    {{if i==0}}
    <div class="psnamelist bgblue"  qyid="{{li.qyid}}">
        <div class="air"></div><span class="namefont colwhite slh1"  title="{{li.qyname}}">{{li.qyname}}</span>
        <div class="jiao jiaoOn"></div>
    </div>
    {{else}}
    <div class="psnamelist"  qyid="{{li.qyid}}">
        <div class="air"></div><span class="namefont">{{li.qyname}}</span>
        <div class="jiao "></div>
    </div>
    {{/if}}
    {{/each}}
</script>

<script type="text/html"  id="temalarm">
    {{each result as li i}}
    <div class="alarmdataDitem">
        <div class="itemalarm mg20"><span>监控点：</span><input type="text" class="readtext" readonly  value="{{li.jiankong}}"></div>
        <div class="itemalarm"><span>污染物：</span><input type="text" class="readtext" readonly value="{{li.wrw}}"></div>
        <div class="itemalarm"><span>报警时间：</span><input type="text" class="readtext" readonly value="{{li.alarmTime}}"></div>
        <div class="itemalarm mg20"><span>起报值：</span><input type="text" class="readtext w50" readonly value="{{li.qival}}"><span>mg/m3</span>  </div>
        <div class="itemalarm"><span>标准值：</span><input type="text" class="readtext w50" readonly value="{{li.biaozhun}}"><span>mg/m3</span></div>
    </div>
    {{/each}}
</script>
<script src="../../static/js/V2.4/base_common.js"></script>
<script src="../../static/js/V2.4/common.min.js"></script>
<!--<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=SfzfIFZ2DMgtKsjSAmVrtgSBL5PyEKVd"></script>-->
<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=SfzfIFZ2DMgtKsjSAmVrtgSBL5PyEKVd&s=1"></script>

<script src="../../static/js/echartV4/echarts.min.js"></script>
<script>
    (function ($) {
        var pageConfig={
            json: {
                //企业类型
                qyType:'../json/qytype.json',

                //行政区划
                area:"../json/area.json",

                //企业列表
                qylist:"../json/qylist.json",

                //基本信息
                basic:"../json/basic.json",

                //监控点
                jiankong:"../json/jiankong.json",

                //数据类型
                dataType:"../json/dataType.json",

                //污染物
                wrw:"../json/wrw.json",

                //监测时间
                jianceTime:"../json/jianceTime.json",

                //折线图和表格数据
                line:"../json/line.json",


                //报警数据
                alarm:"../json/alarm.json",

                //gis定位信息
                gis:"../json/gis.json"
            }

        }

        var qytypeid,areaid,qyname;   //企业类型id,行政区划id,企业名称

        //企业id
        var qyid;


        var jianid,dataTypeid,wrwid,jianceTimeid;   //监控点id,数据类型id,污染物id,监测时间id

        var alarmCode;  //超标报警0，超总量报警1，故障报警2

        var initPage = {
            condition:function(){
                var count=0;
                var doquery=function(){
                    if(count>=1){
                        initPage.qylist(initPage.params())
                    }
                    count++;
                }
                $("#qytype").combobox({
                    method:'get',
                    url: pageConfig.json.qyType,
                    width: '100%',
                    height: '10.5%',
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    onLoadSuccess:function (data) {
                        $(this).combobox('setValue',data[0].text)
                        qytypeid=data[0].id;
                        doquery()
                    },
                    onSelect:function (data) {
                        qytypeid=data.id
                    }
                })

                $("#area").combobox({
                    method: 'get',
                    url: pageConfig.json.area,
                    width: '100%',
                    height: '10.5%',
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    onLoadSuccess:function (data) {
                        $(this).combobox('setValue',data[0].text)
                        areaid=data[0].id;
                        doquery();
                    },
                    onSelect:function (data) {
                        areaid=data.id;
                    }
                })
            },
            qylist:function(params){
                Public.get(pageConfig.json.qylist,params,function (data) {
                    qyid=data.qylist[0].qyid;

                    //初始化企业列表
                    var sourceHTML = template("qylist", {result:data.qylist});
                    document.querySelector(".psnamebox").innerHTML = sourceHTML;
                    //初始化基本信息
                    initPage.basic(qyid);
//


                    //切换企业
                    $('.psnamelist').click(function () {
                        $(this).addClass('bgblue').siblings().removeClass('bgblue')
                        $(this).find('.namefont').addClass('colwhite')
                        $(this).siblings().find('.namefont').removeClass('colwhite')
                        $(this).find('.jiao').addClass('jiaoOn')
                        $(this).siblings().find('.jiao').removeClass('jiaoOn')
                        qyid=$(this).attr('qyid');


                        if($('.tabactive').index()==0){
                            //基本信息
                            initPage.basic(qyid);
                        }else if($('.tabactive').index()==1){
                            //历史数据
                            initPage.hisConditions(qyid);
                        }else if($('.tabactive').index()==2){
                            //报警信息
                            initPage.alarmData(qyid,$('.btnalarmAct').index())
                        }else if($('.tabactive').index()==3){
                            //gis定位
                            initPage.gis(qyid);
                        }

                    })
                })
            },
            params:function(){
                qyname=$('#qyname').val();
                return {qytypeid:qytypeid,areaid:qytypeid,qyname:qytypeid}
            },
            basic:function(qyid){
                //基本信息
                Public.get(pageConfig.json.basic,{qyid:qyid},function (data) {
                    $('#basicform').form("load",data.basicData)
                })
            },
            historyData:function(qyid){
                //加载历史数据折线图和表格
                var  params=$.extend({qyid:qyid},initPage.historyParams());
                Public.get(pageConfig.json.line,params,function (data) {

                    var myChart = echarts.init(document.getElementById('main'))
                    var option = {
                        //        title : {
                        //            text: '雨量流量关系图',
                        //            x: 'center'
                        //        },
                        tooltip : {
                            trigger: 'axis',

                        },
                        toolbox: {
                            show : true,

                        },
                        xAxis : [
                            {
                                type : 'category',
                                boundaryGap : false,
                                axisLine: {
                                    onZero: false,
                                    lineStyle:{
                                        color:"#2477AB"
                                    },

                                },
                                data : data.xAxis
                            }
                        ],
                        yAxis : [
                            {
                                name : '流量(m^3/s)',
                                type : 'value',

                                axisLine:{
                                    lineStyle:{
                                        color:"#2477AB"
                                    }
                                }
                            }

                        ],
                        series : [
                            {
                                name:'流量',
                                type:'line',
                                itemStyle: {normal: {areaStyle: {type: 'default'}}},
                                data:data.series,
                                color:"#90DBDE"
                            }

                        ]
                    };
                    myChart.setOption(option);



                    $('#historyTable').datagrid({
                        method: "GET",
                        data:data.tableData,
                        fitColumns: true,
                        singleSelect:true,
                        fixed:true,
                        columns: [[
                            {title: '监测时间', field: 'f1', width: $(this).width() * 0.3, align: 'center',styler:function (value,row,index) {
                                return 'color:#858585';
                            }},
                            {title: '实测浓度', field: 'f2', width: $(this).width() * 0.1,align: 'center',formatter:function (value, row, index) {
                                return '<span style="color: #FF534C">'+value+'</span>'
                            }},
                            {title: '折算浓度', field: 'f3', width: $(this).width() * 0.1, align: 'center',formatter:function (value, row, index) {
                                return '<span style="color: #33AB18">'+value+'</span>'
                            }},
                            {title: '标准值', field: 'f4', width: $(this).width() * 0.1, align: 'center',formatter:function (value, row, index) {
                                return '<span style="color: #33AB18">'+value+'</span>'
                            }},
                            {title: '排放量', field: 'f5', width: $(this).width() * 0.1, align: 'center',formatter:function (value, row, index) {
                                return '<span style="color: #33AB18">'+value+'</span>'
                            }},
                        ]],
                        onDblClickRow:function (index,row) {

                        },
                        onLoadSuccess: function (data, response) {

                        },
                        onClickRow:function (index, row) {

                        }
                    });




                })

            },
            historyParams:function(){
                return {jianid:jianid,dataTypeid:dataTypeid,wrwid:wrwid,jianceTimeid:jianceTimeid}
            },
            hisConditions:function(qyid){
                var count=0;
                var doquery=function(){
                    if(count>=3){
                        initPage.historyData(qyid);
                    }
                    count++;
                }


                $("#jk").combobox({
                    method: 'get',
                    url: pageConfig.json.jiankong,
                    width: '100%',
                    height: '30%',
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    queryParams:{"qyid":qyid},
                    onLoadSuccess:function (data) {
                        jianid=data[0].id
                        doquery();
                    },
                    onSelect:function (data) {
                        jianid=data.id
                    }
                })

                $("#datatype").combobox({
                    method: 'get',
                    url: pageConfig.json.dataType,
                    width: '100%',
                    height: '30%',
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    queryParams:{"qyid":qyid},
                    onLoadSuccess:function (data) {
                        dataTypeid=data[0].id;
                        doquery();
                    },
                    onSelect:function (data) {
                        dataTypeid=data.id;
                    }
                })

                $(".wrw").combobox({
                    method: 'get',
                    url: pageConfig.json.wrw,
                    width: '100%',
                    height: '30%',
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    queryParams:{"qyid":qyid},
                    onLoadSuccess:function (data) {
                        wrwid=data[0].id
                        doquery();
                    },
                    onSelect:function (data) {
                        wrwid=data.id
                    }
                })
                $(".jctime").combobox({
                    method: 'get',
                    url: pageConfig.json.jianceTime,
                    width: '100%',
                    height: '30%',
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    queryParams:{"qyid":qyid},
                    onLoadSuccess:function (data) {
                        jianceTimeid=data[0].id;
                        doquery();
                    },
                    onSelect:function (data) {
                        jianceTimeid=data.id;
                    }
                })
            },

            alarmData:function(qyid,alarmCode){
                //初始化报警信息
                //   alarmCode=0;
                var  alarmParam=$.extend({"qyid":qyid},{"alarmCode":alarmCode});
                Public.get(pageConfig.json.alarm,alarmParam,function (data) {
                    //初始化企业列表
                    var sourceHTML = template("temalarm", {result:data.data});
                    document.querySelector(".alarmdataD").innerHTML = sourceHTML;
                })
            },
            gis:function(qyid){

                Public.get(pageConfig.json.gis,{"qyid":qyid},function (data) {
                    var map = new BMap.Map("mapDiv",{
                        enableMapClick : false,  //去掉点击位置，弹出的搜索信息
                    });
                    map.enableScrollWheelZoom(true);
                    var point = new BMap.Point(116.400244,39.92556);
                    map.centerAndZoom(point, 11);
                    var marker = new BMap.Marker(point);// 创建标注
                    map.addOverlay(marker);             // 将标注添加到地图中
                })


            },
            events:function(){
                //查询
                $('.tancheck').click(function(){
                    this.qylist(this.params());
                })

                //电话
                $('.phone').click(function () {

                })

                //加关注
                $('.addguan').click(function () {

                })

                // 切换选项卡
                $('.tabitem').click(function () {
                    $(this).addClass('tabactive').siblings().removeClass('tabactive')
                    if($(this).index()==0){
                        // 基本信息
                        $('.findDataRdown').css('display',"flex");
                        $(".findDataRdownData").hide();
                        $(".findDataRdownalarmData").hide();
                        $(".findDataRdownGis").hide();
                        initPage.basic(qyid);

                    }else if($(this).index()==1){
                        //历史数据
                        $('.findDataRdown').hide();
                        $(".findDataRdownData").css('display',"flex");
                        $(".findDataRdownalarmData").hide();
                        $(".findDataRdownGis").hide();

                        var fw=$('.historyMid').width()
                        var fh= $('.historyMid').height()
                        $('#main').width(fw)
                        $('#main').height(fh)




                        //初始化历史数据
                        initPage.hisConditions(qyid);



                    }else  if($(this).index()==2){
                        //报警信息
                        $('.findDataRdown').hide();
                        $(".findDataRdownData").hide();
                        $(".findDataRdownalarmData").css('display',"flex");
                        $(".findDataRdownGis").hide();

                        //初始化报警数据
                        initPage.alarmData(qyid,0)


                    }else  if($(this).index()==3){
                        //gis定位
                        $('.findDataRdown').hide();
                        $(".findDataRdownData").hide();
                        $(".findDataRdownalarmData").hide();
                        $(".findDataRdownGis").css('display',"flex");

                        initPage.gis(qyid);
                    }

                })


                //历史数据查询
                $('.hisbtn').click(function () {
                    initPage.historyData(qyid)
                })


                // 报警信息选项卡切换
                $(".btnalarm").click(function () {
                    $(this).addClass('btnalarmAct').siblings().removeClass('btnalarmAct')
                    initPage.alarmData(qyid,$(this).index())
                })



            },
            init:function(){
                this.condition();
                this.events();

            }
        }

        $(document).ready(function () {
            initPage.init();
        });
    }(jQuery));

</script>
</body>
</html>